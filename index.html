<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>AI å°æŠ—è¨­è¨ˆå·¥å…· - ç¬¦è™Ÿèˆ‡æ–‡å­—é®ç½©ç‰ˆ</title>
    <style>
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; display: flex; flex-direction: column; align-items: center; background: #1a1a1a; color: #eee; padding: 20px; }
        .controls { background: #2c2c2c; padding: 20px; border-radius: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; width: 100%; max-width: 800px; border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .full-width { grid-column: span 2; }
        .section-title { font-weight: bold; color: #9b59b6; margin-top: 10px; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .mode-selector { background: #3d3d3d; padding: 15px; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
        canvas { 
            max-width: 95vw; border: 2px solid #555;
            background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="text"] { width: 100%; padding: 10px; box-sizing: border-box; background: #444; border: 1px solid #666; color: white; border-radius: 6px; }
        label { font-size: 13px; color: #ccc; display: block; margin-bottom: 5px; }
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-random { background: #34495e; color: white; }
        .btn-random:hover { background: #2c3e50; }
        .btn-download { background: #27ae60; color: white; }
        .btn-download:hover { background: #219150; }
        .highlight { color: #f1c40f; font-weight: bold; }
    </style>
</head>
<body>

    <h2>ğŸ¨ AI è¦–è¦ºå°æŠ—å·¥å…· (æ–‡å­—ç¬¦è™ŸåŠ å¼·ç‰ˆ)</h2>

    <div class="controls">
        <div class="full-width">
            <label>1. ä¸Šå‚³åº•åœ–ï¼š</label>
            <input type="file" id="upload" accept="image/*">
        </div>
        
        <div class="full-width section-title">ç¬¦è™Ÿèˆ‡é®ç½©è¨­å®š</div>
        <div class="full-width">
            <label>è‡ªå®šç¾©æ–‡å­—ç¬¦è™Ÿ (ç³»çµ±æœƒéš¨æ©Ÿå¾ä¸­æŒ‘é¸å­—å…ƒä½œç‚ºé®ç½©)ï¼š</label>
            <input type="text" id="customSymbols" value="â– â—âœ–â›°ï¸â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸âœšâœ¦â™¥â‹âˆâš¡ï¸0123456789ABCDEF@#$%&">
        </div>

        <div class="mode-selector full-width">
            <label style="width:100%"><span class="highlight">å‘ˆç¾ä½ç½®ï¼š</span></label>
            <input type="radio" name="displayPos" id="posBoard" value="board" checked><label for="posBoard">åœ–ç‰‡åœ¨åº• (ç¬¦è™ŸæŒ–å­”)</label>
            <input type="radio" name="displayPos" id="posHole" value="hole"><label for="posHole">ç¬¦è™Ÿå…§é¡¯åœ– (é•‚ç©ºæ•ˆæœ)</label>
        </div>

        <div>
            <label>ç¬¦è™Ÿ/æ–‡å­—å¤§å°: <span id="val-radius">25</span></label>
            <input type="range" id="radius" min="5" max="150" value="25">
        </div>
        <div>
            <label>åˆ†ä½ˆå¯†åº¦: <span id="val-spacing">35</span></label>
            <input type="range" id="spacing" min="10" max="200" value="35">
        </div>
        
        <div class="full-width section-title">é ‚å±¤æ–‡å­—ä¿è­·</div>
        <div class="full-width">
            <input type="text" id="overlayText" placeholder="è¼¸å…¥æµ®æ°´å°æ–‡å­—...">
        </div>
        <div>
            <label>æµ®æ°´å°å¤§å°: <span id="val-fontSize">80</span></label>
            <input type="range" id="fontSize" min="20" max="500" value="80">
        </div>
        <div>
            <label>æµ®æ°´å°é¡è‰²ï¼š</label>
            <input type="color" id="textColor" value="#ffffff" style="width:100%">
        </div>
        
        <button id="re-random" class="btn-random full-width">é‡æ–°æ’åˆ—ç¬¦è™Ÿéš¨æ©Ÿä½ç§»</button>
        <button id="download" class="btn-download full-width">ä¸‹è¼‰ PNG çµæœ</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const upload = document.getElementById('upload');
        const customSymbolsInput = document.getElementById('customSymbols');
        
        // æ§åˆ¶é … ID åˆ—è¡¨ï¼Œç”¨æ–¼è‡ªå‹•ç›£è½
        const controls = ['radius', 'spacing', 'fontSize', 'textColor', 'overlayText', 'customSymbols'];
        let img = new Image();

        upload.addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (f) => {
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    draw();
                };
                img.src = f.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        controls.forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                const span = document.getElementById(`val-${id}`);
                if (span) span.textContent = document.getElementById(id).value;
                if (img.src) draw();
            });
        });

        document.getElementsByName('displayPos').forEach(r => r.onchange = () => { if(img.src) draw(); });
        document.getElementById('re-random').onclick = () => { if(img.src) draw(); };

        // æ ¸å¿ƒç¹ªåœ–å‡½æ•¸
        function drawSymbols(sRadius, sSpacing, isMaskMode) {
            const symbolString = customSymbolsInput.value || "â—";
            // å°‡å­—ä¸²è½‰ç‚ºé™£åˆ—ä»¥æ­£ç¢ºè™•ç† Unicode ç¬¦è™Ÿ
            const symbolArray = Array.from(symbolString);
            
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = `${sRadius}px 'Arial', sans-serif`;

            for (let y = 0; y < canvas.height + sSpacing; y += sSpacing) {
                for (let x = 0; x < canvas.width + sSpacing; x += sSpacing) {
                    ctx.save();
                    // éš¨æ©Ÿä½ç§»å¢åŠ æ··äº‚åº¦
                    const jitter = sSpacing * 0.4;
                    const dx = (Math.random() - 0.5) * jitter;
                    const dy = (Math.random() - 0.5) * jitter;
                    
                    ctx.translate(x + dx, y + dy);
                    ctx.rotate(Math.random() * Math.PI * 2);
                    
                    ctx.fillStyle = 'black'; 
                    const char = symbolArray[Math.floor(Math.random() * symbolArray.length)];
                    ctx.fillText(char, 0, 0);
                    ctx.restore();
                }
            }
        }

        function draw() {
            if (!img.src) return;
            const sRadius = parseInt(document.getElementById('radius').value);
            const sSpacing = parseInt(document.getElementById('spacing').value);
            const fSize = parseInt(document.getElementById('fontSize').value);
            const txt = document.getElementById('overlayText').value;
            
            let displayPos = 'board';
            document.getElementsByName('displayPos').forEach(r => { if(r.checked) displayPos = r.value; });

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (displayPos === 'board') {
                // æ¨¡å¼ Aï¼šåœ–ç‰‡åœ¨åº•ï¼Œç¬¦è™ŸæŒ–å­”
                ctx.globalCompositeOperation = 'source-over';
                ctx.drawImage(img, 0, 0);
                ctx.globalCompositeOperation = 'destination-out';
                drawSymbols(sRadius, sSpacing, true);
            } else {
                // æ¨¡å¼ Bï¼šåœ–ç‰‡åªå‡ºç¾åœ¨ç¬¦è™Ÿè£¡ (é•‚ç©º)
                ctx.globalCompositeOperation = 'source-over';
                drawSymbols(sRadius, sSpacing, true);
                ctx.globalCompositeOperation = 'source-in';
                ctx.drawImage(img, 0, 0);
            }

            // æœ€å¾Œç•«ä¸Šé ‚å±¤æµ®æ°´å°æ–‡å­—
            ctx.globalCompositeOperation = 'source-over';
            if (txt) {
                ctx.font = `bold ${fSize}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                // åŠ å€‹æé‚Šå¢åŠ å¯è®€æ€§/å¹²æ“¾åº¦
                ctx.strokeStyle = 'rgba(0,0,0,0.5)';
                ctx.lineWidth = fSize / 10;
                ctx.strokeText(txt, canvas.width / 2, canvas.height / 2);
                ctx.fillStyle = document.getElementById('textColor').value;
                ctx.fillText(txt, canvas.width / 2, canvas.height / 2);
            }
        }

        document.getElementById('download').onclick = () => {
            if (!img.src) return alert('è«‹å…ˆä¸Šå‚³åœ–ç‰‡');
            const link = document.createElement('a');
            link.download = 'ai-adversarial-symbol-mask.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        };
    </script>
</body>
</html>
