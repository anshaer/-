<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片轉 1 秒影片工具</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 50px; background: #f4f4f9; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        #preview { max-width: 300px; margin-top: 20px; display: none; border-radius: 8px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px; font-size: 16px; }
        button:disabled { background: #ccc; }
        #status { margin-top: 15px; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <h2>圖片轉影片 (1秒)</h2>
    <input type="file" id="imageInput" accept="image/*">
    <br>
    <img id="preview" src="" alt="預覽圖">
    <br>
    <button id="convertBtn" disabled>開始轉換並下載</button>
    <div id="status"></div>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const convertBtn = document.getElementById('convertBtn');
    const status = document.getElementById('status');

    let selectedImage = null;

    // 當使用者選擇圖片時
    imageInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                preview.src = event.target.result;
                preview.style.display = 'block';
                selectedImage = new Image();
                selectedImage.src = event.target.result;
                selectedImage.onload = () => {
                    convertBtn.disabled = false;
                    status.innerText = "圖片已就緒";
                };
            };
            reader.readAsDataURL(file);
        }
    });

    // 轉換核心邏輯
    convertBtn.addEventListener('click', () => {
        const duration = 1000; // 1秒
        const fps = 30;        // 每秒幀數
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        // 設定影片解析度（以圖片原始尺寸為準）
        canvas.width = selectedImage.width;
        canvas.height = selectedImage.height;

        // 建立錄製串流
        const stream = canvas.captureStream(fps);
        const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
        const chunks = [];

        recorder.ondataavailable = (e) => chunks.push(e.data);
        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'output_video.webm';
            a.click();
            status.innerText = "轉換完成！已開始下載。";
        };

        // 開始錄製
        recorder.start();
        status.innerText = "正在錄製中...";

        // 繪製畫面（每秒 30 次，持續 1 秒）
        let startTime = Date.now();
        const interval = setInterval(() => {
            ctx.drawImage(selectedImage, 0, 0);
            if (Date.now() - startTime >= duration) {
                clearInterval(interval);
                recorder.stop();
            }
        }, 1000 / fps);
    });
</script>

</body>
</html>
